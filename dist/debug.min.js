(()=>{const FA=window.FormAttribution;if(!FA){console.warn("[FormAttribution Debug] FormAttribution API not found");return}const STYLES='/**\n * Form Attribution - Debug Overlay Styles\n * Injected into Shadow DOM for style isolation\n */\n\n:host {\n  --fa-bg: light-dark(hsl(0 0% 100%), hsl(240 10% 3.9%));\n  --fa-fg: light-dark(hsl(240 10% 3.9%), hsl(0 0% 98%));\n  --fa-muted: light-dark(hsl(240 4.8% 95.9%), hsl(240 3.7% 15.9%));\n  --fa-muted-fg: light-dark(hsl(240 3.8% 46.1%), hsl(240 5% 64.9%));\n  --fa-border: light-dark(hsl(240 5.9% 90%), hsl(240 3.7% 15.9%));\n  --fa-accent: light-dark(hsl(240 4.8% 95.9%), hsl(240 3.7% 15.9%));\n  --fa-success: hsl(142 76% 36%);\n  --fa-warning: hsl(38 92% 50%);\n  --fa-destructive: hsl(0 84.2% 60.2%);\n  --fa-radius: 0.5rem;\n  --fa-shadow:\n    0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);\n  --fa-font: ui-sans-serif, system-ui, sans-serif;\n  --fa-font-mono:\n    ui-monospace, SFMono-Regular, "SF Mono", Menlo, Monaco, Consolas, monospace;\n\n  position: fixed;\n  z-index: 999999;\n  font-family: var(--fa-font);\n  font-size: 13px;\n  line-height: 1.4;\n  color-scheme: light dark;\n}\n\n* {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\n/* Panel */\n.panel {\n  width: var(--fa-panel-width, 340px);\n  max-width: calc(100vw - 32px);\n  background: var(--fa-bg);\n  border: 1px solid var(--fa-border);\n  border-radius: var(--fa-radius);\n  box-shadow: var(--fa-shadow);\n  overflow: hidden;\n}\n\n.panel.hidden {\n  display: none;\n}\n\n/* Header */\n.header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 10px 12px;\n  background: color-mix(in srgb, var(--fa-muted) 50%, transparent);\n  border-bottom: 1px solid var(--fa-border);\n  cursor: move;\n  user-select: none;\n}\n\n.title {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n  font-size: 13px;\n  color: var(--fa-fg);\n}\n\n.title svg {\n  width: 14px;\n  height: 14px;\n  color: var(--fa-muted-fg);\n}\n\n.controls {\n  display: flex;\n  gap: 4px;\n}\n\n.ctrl-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  background: transparent;\n  border: none;\n  border-radius: 4px;\n  color: var(--fa-muted-fg);\n  cursor: pointer;\n  transition:\n    background-color 0.15s,\n    color 0.15s;\n}\n\n.ctrl-btn:hover {\n  background: var(--fa-accent);\n  color: var(--fa-fg);\n}\n\n.ctrl-btn svg {\n  width: 14px;\n  height: 14px;\n}\n\n/* Status Bar */\n.status {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 12px;\n  padding: 10px 12px;\n  background: color-mix(in srgb, var(--fa-muted) 25%, transparent);\n  border-bottom: 1px solid var(--fa-border);\n  font-size: 12px;\n}\n\n.status-item {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  color: var(--fa-muted-fg);\n}\n\n.status-dot {\n  width: 6px;\n  height: 6px;\n  border-radius: 50%;\n  background: var(--fa-success);\n  box-shadow: 0 0 4px var(--fa-success);\n}\n\n.status-dot.inactive {\n  background: var(--fa-muted-fg);\n  box-shadow: none;\n}\n\n.status-dot.warning {\n  background: var(--fa-warning);\n  box-shadow: 0 0 4px var(--fa-warning);\n}\n\n.status-value {\n  color: var(--fa-fg);\n  font-weight: 500;\n}\n\n/* Tabs */\n.tabs {\n  display: flex;\n  border-bottom: 1px solid var(--fa-border);\n}\n\n.tab {\n  flex: 1;\n  padding: 8px;\n  font-size: 12px;\n  font-weight: 500;\n  font-family: inherit;\n  background: transparent;\n  border: none;\n  border-bottom: 2px solid transparent;\n  color: var(--fa-muted-fg);\n  cursor: pointer;\n  transition:\n    color 0.15s,\n    border-color 0.15s,\n    background-color 0.15s;\n}\n\n.tab:hover {\n  color: var(--fa-fg);\n  background: color-mix(in srgb, var(--fa-muted) 25%, transparent);\n}\n\n.tab.active {\n  color: var(--fa-fg);\n  border-bottom-color: var(--fa-fg);\n}\n\n.tab-content {\n  display: none;\n}\n\n.tab-content.active {\n  display: block;\n}\n\n/* Data Rows */\n.section-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 8px 12px;\n  font-size: 11px;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  color: var(--fa-muted-fg);\n  background: color-mix(in srgb, var(--fa-muted) 15%, transparent);\n}\n\n.badge {\n  font-size: 10px;\n  font-weight: 500;\n  padding: 2px 6px;\n  background: var(--fa-muted);\n  color: var(--fa-fg);\n  border-radius: 4px;\n  text-transform: none;\n  letter-spacing: normal;\n}\n\n.data-list {\n  max-height: 200px;\n  overflow-y: auto;\n}\n\n.data-list:nth-child(1 of .data-list) {\n  max-height: 150px;\n}\n\n.data-row {\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-between;\n  gap: 12px;\n  padding: 8px 12px;\n  border-bottom: 1px solid color-mix(in srgb, var(--fa-border) 50%, transparent);\n  transition: background-color 0.15s;\n}\n\n.data-row:last-child {\n  border-bottom: none;\n}\n\n.data-row:hover {\n  background: color-mix(in srgb, var(--fa-muted) 25%, transparent);\n}\n\n.data-key {\n  flex-shrink: 0;\n  font-family: var(--fa-font-mono);\n  font-size: 12px;\n  color: var(--fa-muted-fg);\n}\n\n.data-value {\n  flex: 1;\n  font-family: var(--fa-font-mono);\n  font-size: 12px;\n  color: var(--fa-fg);\n  text-align: right;\n  word-break: break-all;\n  max-width: 180px;\n}\n\n.data-value.empty {\n  color: var(--fa-muted-fg);\n  font-style: italic;\n}\n\n/* Forms List */\n.form-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 8px 12px;\n  border-bottom: 1px solid color-mix(in srgb, var(--fa-border) 50%, transparent);\n  transition: background-color 0.15s;\n  cursor: pointer;\n}\n\n.form-item:last-child {\n  border-bottom: none;\n}\n\n.form-item:hover {\n  background: color-mix(in srgb, var(--fa-muted) 25%, transparent);\n}\n\n.form-item.no-highlight {\n  cursor: default;\n}\n\n.form-item.no-highlight:hover {\n  background: transparent;\n}\n\n.form-item:active {\n  background: color-mix(in srgb, var(--fa-muted) 40%, transparent);\n}\n\n.form-name {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-family: var(--fa-font-mono);\n  font-size: 12px;\n  color: var(--fa-fg);\n}\n\n.form-name svg {\n  width: 12px;\n  height: 12px;\n  color: var(--fa-muted-fg);\n}\n\n.form-status {\n  font-size: 11px;\n  font-weight: 500;\n  padding: 2px 6px;\n  border-radius: 4px;\n}\n\n.form-status.injected {\n  background: color-mix(in srgb, var(--fa-success) 15%, transparent);\n  color: var(--fa-success);\n}\n\n.form-status.excluded {\n  background: color-mix(in srgb, var(--fa-destructive) 15%, transparent);\n  color: var(--fa-destructive);\n}\n\n.form-status.ready {\n  background: var(--fa-muted);\n  color: var(--fa-muted-fg);\n}\n\n/* Log */\n.log-list {\n  max-height: 160px;\n  overflow-y: auto;\n  font-family: var(--fa-font-mono);\n  font-size: 11px;\n}\n\n.log-entry {\n  display: flex;\n  gap: 8px;\n  padding: 6px 12px;\n  border-bottom: 1px solid color-mix(in srgb, var(--fa-border) 30%, transparent);\n}\n\n.log-entry:last-child {\n  border-bottom: none;\n}\n\n.log-time {\n  flex-shrink: 0;\n  color: var(--fa-muted-fg);\n}\n\n.log-msg {\n  color: var(--fa-fg);\n}\n\n.log-msg.success {\n  color: var(--fa-success);\n}\n\n.log-msg.warning {\n  color: var(--fa-warning);\n}\n\n.log-msg.error {\n  color: var(--fa-destructive);\n}\n\n/* Actions */\n.actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 6px;\n  padding: 8px 12px;\n  background: color-mix(in srgb, var(--fa-muted) 25%, transparent);\n  border-top: 1px solid var(--fa-border);\n}\n\n.docs-link {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  margin-right: auto;\n  font-size: 12px;\n  font-weight: 500;\n  color: var(--fa-muted-fg);\n  text-decoration: none;\n  transition: color 0.15s;\n}\n\n.docs-link:hover {\n  color: var(--fa-fg);\n}\n\n.docs-link svg {\n  width: 14px;\n  height: 14px;\n}\n\n.action-btn {\n  display: grid;\n  place-items: center;\n  width: 28px;\n  height: 28px;\n  padding: 0;\n  background: var(--fa-bg);\n  border: 1px solid var(--fa-border);\n  border-radius: 4px;\n  color: var(--fa-fg);\n  cursor: pointer;\n  transition:\n    background-color 0.15s,\n    border-color 0.15s,\n    color 0.15s;\n}\n\n.action-btn:hover {\n  background: var(--fa-accent);\n}\n\n.action-btn.success {\n  background: color-mix(in srgb, var(--fa-success) 15%, transparent);\n  border-color: var(--fa-success);\n  color: var(--fa-success);\n}\n\n.action-btn svg {\n  grid-area: 1 / 1;\n  width: 14px;\n  height: 14px;\n  transition: opacity 0.15s;\n}\n\n.action-btn .icon-check {\n  opacity: 0;\n}\n\n.action-btn.success .icon-default {\n  opacity: 0;\n}\n\n.action-btn.success .icon-check {\n  opacity: 1;\n}\n\n/* Collapsed State */\n.collapsed-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: var(--fa-collapsed-width, 40px);\n  height: var(--fa-collapsed-width, 40px);\n  background: var(--fa-bg);\n  border: 1px solid var(--fa-border);\n  border-radius: var(--fa-radius);\n  box-shadow: var(--fa-shadow);\n  cursor: pointer;\n  transition: transform 0.15s;\n}\n\n.collapsed-btn.hidden {\n  display: none;\n}\n\n.collapsed-btn:hover {\n  transform: scale(1.05);\n}\n\n.collapsed-btn svg {\n  width: 18px;\n  height: 18px;\n  color: var(--fa-fg);\n}\n\n.collapsed-badge {\n  position: absolute;\n  top: -4px;\n  right: -4px;\n  width: 14px;\n  height: 14px;\n  background: var(--fa-success);\n  border: 2px solid var(--fa-bg);\n  border-radius: 50%;\n}\n\n/* Empty State */\n.empty {\n  padding: 24px;\n  text-align: center;\n  color: var(--fa-muted-fg);\n  font-size: 13px;\n}\n\n.empty svg {\n  width: 24px;\n  height: 24px;\n  margin: 0 auto 8px;\n  opacity: 0.5;\n}\n\n/* Scrollbar */\n.data-list::-webkit-scrollbar,\n.log-list::-webkit-scrollbar {\n  width: 6px;\n}\n\n.data-list::-webkit-scrollbar-track,\n.log-list::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.data-list::-webkit-scrollbar-thumb,\n.log-list::-webkit-scrollbar-thumb {\n  background: var(--fa-border);\n  border-radius: 3px;\n}\n\n.data-list::-webkit-scrollbar-thumb:hover,\n.log-list::-webkit-scrollbar-thumb:hover {\n  background: var(--fa-muted-fg);\n}\n\n/* Responsive */\n@media (max-width: 400px) {\n  .panel {\n    max-width: calc(100vw - 16px);\n  }\n}\n';const TEMPLATE='\x3c!-- Form Attribution - Debug Overlay Template --\x3e\n\n\x3c!-- Expanded Panel --\x3e\n<div class="panel" id="panel">\n  <div class="header" id="drag-handle">\n    <div class="title">\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill="none"\n        stroke="currentColor"\n        stroke-width="2"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n      >\n        <path d="m18 16 4-4-4-4"/>\n        <path d="m6 8-4 4 4 4"/>\n        <path d="m14.5 4-5 16"/>\n      </svg>\n      Form Attribution\n    </div>\n    <div class="controls">\n      <button class="ctrl-btn" id="btn-minimize" title="Minimize">\n        <svg\n          xmlns="http://www.w3.org/2000/svg"\n          viewBox="0 0 24 24"\n          fill="none"\n          stroke="currentColor"\n          stroke-width="2"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        >\n          <path d="M5 12h14"/>\n        </svg>\n      </button>\n      <button class="ctrl-btn" id="btn-close" title="Close">\n        <svg\n          xmlns="http://www.w3.org/2000/svg"\n          viewBox="0 0 24 24"\n          fill="none"\n          stroke="currentColor"\n          stroke-width="2"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        >\n          <path d="M18 6 6 18"/>\n          <path d="m6 6 12 12"/>\n        </svg>\n      </button>\n    </div>\n  </div>\n\n  <div class="status" id="status-bar">\n    \x3c!-- Populated dynamically --\x3e\n  </div>\n\n  <div class="tabs">\n    <button class="tab active" data-tab="data">Data</button>\n    <button class="tab" data-tab="forms">Forms</button>\n    <button class="tab" data-tab="log">Log</button>\n  </div>\n\n  <div class="tab-content active" id="tab-data">\n    \x3c!-- Populated dynamically --\x3e\n  </div>\n\n  <div class="tab-content" id="tab-forms">\n    \x3c!-- Populated dynamically --\x3e\n  </div>\n\n  <div class="tab-content" id="tab-log">\n    <div class="log-list" id="log-list">\n      \x3c!-- Populated dynamically --\x3e\n    </div>\n  </div>\n\n  <div class="actions">\n    <a class="docs-link" id="docs-link" href="#" target="_blank" rel="noopener">\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill="none"\n        stroke="currentColor"\n        stroke-width="2"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        aria-hidden="true"\n      >\n        <path\n          d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20"\n        />\n      </svg>\n      Docs\n    </a>\n    <button class="action-btn" id="btn-copy" title="Copy as JSON">\n      <svg\n        class="icon-default"\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill="none"\n        stroke="currentColor"\n        stroke-width="2"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        aria-hidden="true"\n      >\n        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>\n        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>\n      </svg>\n      <svg\n        class="icon-check"\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill="none"\n        stroke="currentColor"\n        stroke-width="2"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        aria-hidden="true"\n      >\n        <path d="M20 6 9 17l-5-5"/>\n      </svg>\n    </button>\n    <button class="action-btn" id="btn-clear" title="Clear Data">\n      <svg\n        class="icon-default"\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill="none"\n        stroke="currentColor"\n        stroke-width="2"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        aria-hidden="true"\n      >\n        <path d="M3 6h18"/>\n        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>\n        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>\n      </svg>\n      <svg\n        class="icon-check"\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill="none"\n        stroke="currentColor"\n        stroke-width="2"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        aria-hidden="true"\n      >\n        <path d="M20 6 9 17l-5-5"/>\n      </svg>\n    </button>\n    <button class="action-btn" id="btn-refresh" title="Refresh Forms">\n      <svg\n        class="icon-default"\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill="none"\n        stroke="currentColor"\n        stroke-width="2"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        aria-hidden="true"\n      >\n        <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>\n        <path d="M3 3v5h5"/>\n        <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>\n        <path d="M16 16h5v5"/>\n      </svg>\n      <svg\n        class="icon-check"\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill="none"\n        stroke="currentColor"\n        stroke-width="2"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        aria-hidden="true"\n      >\n        <path d="M20 6 9 17l-5-5"/>\n      </svg>\n    </button>\n  </div>\n</div>\n\n\x3c!-- Collapsed Button --\x3e\n<div class="collapsed-btn hidden" id="collapsed" title="Expand Debug Panel">\n  <svg\n    xmlns="http://www.w3.org/2000/svg"\n    viewBox="0 0 24 24"\n    fill="none"\n    stroke="currentColor"\n    stroke-width="2"\n    stroke-linecap="round"\n    stroke-linejoin="round"\n  >\n    <path d="m18 16 4-4-4-4"/>\n    <path d="m6 8-4 4 4 4"/>\n    <path d="m14.5 4-5 16"/>\n  </svg>\n  <span class="collapsed-badge"></span>\n</div>\n';const STORAGE_KEY="fa_debug_state";const COLLAPSED_WIDTH=40;const PANEL_WIDTH=340;let isCollapsed=false;let activeTab="data";let logEntries=[];let position={bottom:16,right:16};const loadState=()=>{try{const stored=sessionStorage.getItem(STORAGE_KEY);if(stored){const state=JSON.parse(stored);isCollapsed=state.isCollapsed??false;activeTab=state.activeTab??"data";position=state.position??{bottom:16,right:16}}}catch{}};const saveState=()=>{try{sessionStorage.setItem(STORAGE_KEY,JSON.stringify({isCollapsed:isCollapsed,activeTab:activeTab,position:position}))}catch{}};const formatTime=(date=new Date)=>date.toLocaleTimeString("en-US",{hour12:false,hour:"2-digit",minute:"2-digit",second:"2-digit"});const addLog=(message,type="info")=>{logEntries.unshift({time:formatTime(),message:message,type:type});if(logEntries.length>50){logEntries=logEntries.slice(0,50)}updateLogTab()};const truncate=(str,maxLen=24)=>{if(!str||str.length<=maxLen){return str||""}return`${str.substring(0,maxLen-3)}...`};const getShortPath=url=>{if(!url){return""}try{const u=new URL(url,window.location.origin);return u.pathname}catch{return url}};const flashSuccess=(btn,duration=1500)=>{btn.classList.add("success");setTimeout(()=>btn.classList.remove("success"),duration)};const highlightForm=formElement=>{if(!formElement){return}const originalOutline=formElement.style.outline;const originalOutlineOffset=formElement.style.outlineOffset;const originalTransition=formElement.style.transition;formElement.style.transition="outline-color 0.3s";formElement.style.outline="3px solid hsl(142 76% 36%)";formElement.style.outlineOffset="2px";formElement.scrollIntoView({behavior:"smooth",block:"center"});setTimeout(()=>{formElement.style.outline="3px solid transparent";setTimeout(()=>{formElement.style.outline=originalOutline;formElement.style.outlineOffset=originalOutlineOffset;formElement.style.transition=originalTransition},300)},1500)};const findFormBySelector=selector=>{if(!selector){return null}try{return document.querySelector(`form${selector}`)}catch{return null}};const el=(tag,attrs={},children=[])=>{const element=document.createElement(tag);for(const[key,value]of Object.entries(attrs)){if(key==="class"){element.className=value}else if(key==="text"){element.textContent=value}else{element.setAttribute(key,value)}}for(const child of Array.isArray(children)?children:[children]){if(typeof child==="string"){element.appendChild(document.createTextNode(child))}else if(child){element.appendChild(child)}}return element};const svg=(paths,size=12)=>{const ns="http://www.w3.org/2000/svg";const s=document.createElementNS(ns,"svg");s.setAttribute("xmlns",ns);s.setAttribute("viewBox","0 0 24 24");s.setAttribute("fill","none");s.setAttribute("stroke","currentColor");s.setAttribute("stroke-width","2");s.setAttribute("stroke-linecap","round");s.setAttribute("stroke-linejoin","round");s.style.width=`${size}px`;s.style.height=`${size}px`;for(const pathData of paths){if(typeof pathData==="string"){const path=document.createElementNS(ns,"path");path.setAttribute("d",pathData);s.appendChild(path)}else{const elem=document.createElementNS(ns,pathData.type||"path");for(const[k,v]of Object.entries(pathData)){if(k!=="type"){elem.setAttribute(k,v)}}s.appendChild(elem)}}return s};const iconPaths={form:[{type:"rect",width:"18",height:"18",x:"3",y:"3",rx:"2"},"M9 3v18","M3 9h6","M3 15h6"]};const clearChildren=element=>{while(element.firstChild){element.removeChild(element.firstChild)}};const createOverlay=()=>{const host=document.createElement("div");host.id="fa-debug-overlay";const shadow=host.attachShadow({mode:"closed"});shadow.innerHTML=`\n      <style>\n        :host {\n          --fa-panel-width: ${PANEL_WIDTH}px;\n          --fa-collapsed-width: ${COLLAPSED_WIDTH}px;\n        }\n        ${STYLES}\n      </style>\n      ${TEMPLATE}\n    `;host.style.cssText=`\n      position: fixed;\n      bottom: ${position.bottom}px;\n      right: ${position.right}px;\n      z-index: 999999;\n    `;document.body.appendChild(host);return{host:host,shadow:shadow}};let host,shadow;let panel,collapsed,statusBar,tabData,tabForms,logList;const initRefs=s=>{panel=s.getElementById("panel");collapsed=s.getElementById("collapsed");statusBar=s.getElementById("status-bar");tabData=s.getElementById("tab-data");tabForms=s.getElementById("tab-forms");logList=s.getElementById("log-list")};const applyState=s=>{panel.classList.toggle("hidden",isCollapsed);collapsed.classList.toggle("hidden",!isCollapsed);for(const tab of s.querySelectorAll(".tab")){tab.classList.toggle("active",tab.dataset.tab===activeTab)}for(const content of s.querySelectorAll(".tab-content")){content.classList.toggle("active",content.id===`tab-${activeTab}`)}};const updateStatusBar=()=>{const config=FA.config;const data=FA.getData();const forms=FA.getForms?.()||[];const paramCount=data?Object.keys(data).filter(k=>!k.startsWith("_")).length:0;clearChildren(statusBar);const statusItem1=el("div",{class:"status-item"},[el("span",{class:`status-dot ${paramCount>0?"":"inactive"}`}),el("span",{text:paramCount>0?"Active":"No Data"})]);const statusItem2=el("div",{class:"status-item"},[el("span",{text:"Storage:"}),el("span",{class:"status-value",text:config.storage||"session"})]);const statusItem3=el("div",{class:"status-item"},[el("span",{text:"Forms:"}),el("span",{class:"status-value",text:String(forms.length)})]);statusBar.append(statusItem1,statusItem2,statusItem3)};const createDataRow=(key,value,displayValue)=>el("div",{class:"data-row"},[el("span",{class:"data-key",text:key}),el("span",{class:"data-value",title:value,text:displayValue})]);const createDataSection=(title,badge,rows)=>{const fragment=document.createDocumentFragment();const headerChildren=[el("span",{text:title})];if(badge){headerChildren.push(el("span",{class:"badge",text:badge}))}fragment.appendChild(el("div",{class:"section-header"},headerChildren));const dataList=el("div",{class:"data-list"});for(const row of rows){dataList.appendChild(row)}fragment.appendChild(dataList);return fragment};const updateDataTab=()=>{const data=FA.getData();clearChildren(tabData);if(!data||Object.keys(data).length===0){tabData.appendChild(el("div",{class:"empty",text:"No attribution data available"}));return}const urlParams=[];const metaParams=[];const metaKeys=["landing_page","current_page","referrer_url","first_touch_timestamp"];for(const[key,value]of Object.entries(data)){if(metaKeys.includes(key)){metaParams.push({key:key,value:value})}else{urlParams.push({key:key,value:value})}}if(urlParams.length>0){const rows=urlParams.map(({key:key,value:value})=>createDataRow(key,value,truncate(value)));tabData.appendChild(createDataSection("URL Parameters",`${urlParams.length} captured`,rows))}if(metaParams.length>0){const rows=metaParams.map(({key:key,value:value})=>{const displayKey=key.replace(/_/g," ");const isUrl=key.includes("page")||key.includes("url");const displayValue=isUrl?truncate(getShortPath(value),20):truncate(value);return createDataRow(displayKey,value,displayValue)});tabData.appendChild(createDataSection("Metadata",null,rows))}};const getFormIdentifier=form=>{if(form.id){return`#${form.id}`}if(form.name){return`[name="${form.name}"]`}return form.selector||"[form]"};const getFormStatus=form=>{if(form.excluded){return{className:"excluded",text:"Excluded"}}if(form.injected){return{className:"injected",text:"Injected"}}return{className:"ready",text:"Ready"}};const createFormItem=form=>{const formName=el("div",{class:"form-name"},[svg(iconPaths.form),document.createTextNode(` ${getFormIdentifier(form)}`)]);const status=getFormStatus(form);const formStatus=el("span",{class:`form-status ${status.className}`,text:status.text});const canHighlight=Boolean(form.selector);const formItem=el("div",{class:canHighlight?"form-item":"form-item no-highlight",title:canHighlight?"Click to highlight":""},[formName,formStatus]);if(canHighlight){formItem.addEventListener("click",()=>{const formElement=findFormBySelector(form.selector);if(formElement){highlightForm(formElement);addLog(`Highlighted form ${getFormIdentifier(form)}`,"info")}})}return formItem};const updateFormsTab=()=>{const forms=FA.getForms?.()||[];clearChildren(tabForms);if(forms.length===0){const emptyState=el("div",{class:"empty"},[svg(iconPaths.form,24),document.createTextNode(" No forms found on page")]);tabForms.appendChild(emptyState);return}const dataList=el("div",{class:"data-list"});for(const form of forms){dataList.appendChild(createFormItem(form))}tabForms.appendChild(dataList)};const updateLogTab=()=>{if(!logList){return}clearChildren(logList);if(logEntries.length===0){logList.appendChild(el("div",{class:"empty",text:"No events logged yet"}));return}for(const entry of logEntries){const logEntry=el("div",{class:"log-entry"},[el("span",{class:"log-time",text:entry.time}),el("span",{class:`log-msg ${entry.type}`,text:entry.message})]);logList.appendChild(logEntry)}};const updateAll=()=>{updateStatusBar();updateDataTab();updateFormsTab();updateLogTab()};const toggleCollapsed=forceState=>{isCollapsed=forceState??!isCollapsed;panel.classList.toggle("hidden",isCollapsed);collapsed.classList.toggle("hidden",!isCollapsed);saveState()};const setupEvents=s=>{for(const tab of s.querySelectorAll(".tab")){tab.addEventListener("click",()=>{for(const t of s.querySelectorAll(".tab")){t.classList.remove("active")}for(const c of s.querySelectorAll(".tab-content")){c.classList.remove("active")}tab.classList.add("active");activeTab=tab.dataset.tab;s.getElementById(`tab-${activeTab}`).classList.add("active");saveState()})}s.getElementById("btn-minimize").addEventListener("click",()=>{toggleCollapsed(true)});s.getElementById("btn-close").addEventListener("click",()=>{host.remove();addLog("Debug overlay closed","warning")});s.getElementById("collapsed").addEventListener("click",()=>{toggleCollapsed(false)});const btnCopy=s.getElementById("btn-copy");btnCopy.addEventListener("click",async()=>{const data=FA.getData();try{await navigator.clipboard.writeText(JSON.stringify(data,null,2));flashSuccess(btnCopy);addLog("Data copied to clipboard","success")}catch{addLog("Failed to copy data","error")}});const btnClear=s.getElementById("btn-clear");btnClear.addEventListener("click",()=>{FA.clear?.();flashSuccess(btnClear);addLog("Storage cleared","warning");updateAll()});const btnRefresh=s.getElementById("btn-refresh");btnRefresh.addEventListener("click",()=>{FA.refresh?.();flashSuccess(btnRefresh);addLog("Forms refreshed","success");updateAll()});let isDragging=false;let startX,startY,startRight,startBottom;const dragHandle=s.getElementById("drag-handle");dragHandle.addEventListener("mousedown",e=>{if(e.target.closest(".ctrl-btn")){return}isDragging=true;startX=e.clientX;startY=e.clientY;startRight=position.right;startBottom=position.bottom;e.preventDefault()});document.addEventListener("mousemove",e=>{if(!isDragging){return}const deltaX=startX-e.clientX;const deltaY=startY-e.clientY;position.right=Math.max(0,Math.min(window.innerWidth-PANEL_WIDTH,startRight+deltaX));position.bottom=Math.max(0,Math.min(window.innerHeight-200,startBottom+deltaY));host.style.right=`${position.right}px`;host.style.bottom=`${position.bottom}px`});document.addEventListener("mouseup",()=>{if(isDragging){isDragging=false;saveState()}})};const setupCallbacks=()=>{if(typeof FA.on==="function"){FA.on("onCapture",({data:data})=>{const count=Object.keys(data||{}).length;addLog(`Captured ${count} parameters`,"success");updateAll()});FA.on("onUpdate",({forms:forms,action:action})=>{if(action==="clear"){addLog(`Cleared ${forms.length} form(s)`,"info")}else{addLog(`Injected into ${forms.length} form(s)`,"info")}updateAll()});FA.on("onReady",()=>{addLog("Initialized","success");updateAll()})}};const init=()=>{loadState();const overlay=createOverlay();host=overlay.host;shadow=overlay.shadow;initRefs(shadow);const docsLink=shadow.getElementById("docs-link");if(docsLink&&FA.docs){docsLink.href=FA.docs}applyState(shadow);setupEvents(shadow);setupCallbacks();addLog("Debug overlay loaded","success");updateAll()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",init,{once:true})}else{init()}})();